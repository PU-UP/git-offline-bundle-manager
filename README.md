# Git ç¦»çº¿åŒ…ç®¡ç†å™¨

> é€šè¿‡å·¥å…·è„šæœ¬å®ç°åŒ…å«å­æ¨¡å—çš„ä»“åº“ç¦»çº¿åŒæ­¥ä¸åä½œå¼€å‘

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Git â‰¥ 2.20
- Bash ç¯å¢ƒ

### ä»“åº“ç»“æ„
```
slam-core/                    # ä¸»ä»“åº“
â”œâ”€â”€ .gitmodules              # å­æ¨¡å—é…ç½®
â”œâ”€â”€ module_a/                # å­æ¨¡å—A
â””â”€â”€ module_b/                # å­æ¨¡å—B
```

---

## ğŸ“‹ å·¥å…·æ¦‚è§ˆ

æœ¬å·¥å…·é›†æä¾›å®Œæ•´çš„ç¦»çº¿å¼€å‘å·¥ä½œæµï¼ŒåŒ…å«ä»¥ä¸‹è„šæœ¬ï¼š

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `export-full.sh` | å¯¼å‡ºå®Œæ•´ä»“åº“åŒ… | æœåŠ¡å™¨ç«¯å‘å¸ƒ |
| `import-feature.sh` | å¯¼å…¥åŠŸèƒ½åˆ†æ”¯åŒ… | æœåŠ¡å™¨ç«¯æ¥æ”¶ |
| `init-from-bundle.sh` | ä»åŒ…æ–‡ä»¶åˆå§‹åŒ–ä»“åº“ | æœ¬åœ°ç«¯é¦–æ¬¡è®¾ç½® |
| `create-feature-branch.sh` | åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ | æœ¬åœ°å¼€å‘å‡†å¤‡ |
| `export-feature.sh` | å¯¼å‡ºåŠŸèƒ½åˆ†æ”¯åŒ… | æœ¬åœ°æäº¤ä»£ç  |
| `update-from-server.sh` | ä»æœåŠ¡å™¨æ›´æ–° | æœ¬åœ°åŒæ­¥æ›´æ–° |

---

## âš™ï¸ é…ç½®è®¾ç½®

### 1. æœåŠ¡å™¨ç«¯é…ç½®

ç¼–è¾‘ `tools/server.config`ï¼š

```ini
[main]
repo_path=/srv/git/slam-core
output_dir=/srv/bundles
# modules=module_a,module_b  # å¯é€‰ï¼šä¸æŒ‡å®šåˆ™è‡ªåŠ¨æ£€æµ‹
```

### 2. æœ¬åœ°ç«¯é…ç½®

ç¼–è¾‘ `tools/local.config`ï¼š

```ini
[main]
repo_path=~/projects/slam-core
bundle_source=/media/usb
# modules=module_a,module_b  # å¯é€‰ï¼šä¸æŒ‡å®šåˆ™è‡ªåŠ¨æ£€æµ‹
feature_branch=dev/awesome-feature
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. æœåŠ¡å™¨ç«¯ - å¯¼å‡ºå®Œæ•´ä»“åº“

```bash
cd tools
./export-full.sh
```

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—
- ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„åŒ…ç›®å½•
- åˆ›å»ºè¯¦ç»†çš„å¯¼å‡ºæŠ¥å‘Š
- æ”¯æŒè‡ªå®šä¹‰é…ç½®æ–‡ä»¶

**è¾“å‡ºï¼š**
```
/srv/bundles/20241201_1430_bundles/
â”œâ”€â”€ slam-core.bundle
â”œâ”€â”€ module_a.bundle
â”œâ”€â”€ module_b.bundle
â””â”€â”€ bundle_report.md
```

### 2. æœ¬åœ°ç«¯ - åˆå§‹åŒ–ä»“åº“

```bash
cd tools
./init-from-bundle.sh
```

**åŠŸèƒ½ï¼š**
- ä»åŒ…æ–‡ä»¶å…‹éš†ä¸»ä»“åº“
- è‡ªåŠ¨åˆå§‹åŒ–æ‰€æœ‰å­æ¨¡å—
- æ™ºèƒ½æ£€æµ‹åˆ†æ”¯åç§°ï¼ˆmain/masterï¼‰
- æä¾›åç»­æ­¥éª¤æŒ‡å¯¼

**å‰ç½®æ¡ä»¶ï¼š**
- ç¡®ä¿åŒ…æ–‡ä»¶åœ¨ `bundle_source` ç›®å½•ä¸­
- ç¡®ä¿ç›®æ ‡è·¯å¾„ä¸å­˜åœ¨

### 3. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯

```bash
cd tools
./create-feature-branch.sh my-feature
```

**åŠŸèƒ½ï¼š**
- ä¸ºä¸»ä»“åº“å’Œæ‰€æœ‰å­æ¨¡å—åˆ›å»º `dev/my-feature` åˆ†æ”¯
- è‡ªåŠ¨åˆ‡æ¢åˆ°æ–°åˆ†æ”¯
- éªŒè¯åˆ†æ”¯åç§°æ ¼å¼
- æä¾›å¼€å‘æŒ‡å¯¼

### 4. å¯¼å‡ºåŠŸèƒ½åˆ†æ”¯åŒ…

```bash
cd tools
./export-feature.sh
```

**åŠŸèƒ½ï¼š**
- å¯¼å‡ºå½“å‰åŠŸèƒ½åˆ†æ”¯çš„å¢é‡åŒ…
- è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—å˜æ›´
- ç”Ÿæˆæ ‡å‡†å‘½åçš„åŒ…æ–‡ä»¶
- æä¾›æäº¤æŒ‡å¯¼

**è¾“å‡ºï¼š**
```
./bundles/
â”œâ”€â”€ slam-core-dev-my-feature.bundle
â”œâ”€â”€ module_a-dev-my-feature.bundle
â””â”€â”€ module_b-dev-my-feature.bundle
```

### 5. æœåŠ¡å™¨ç«¯ - å¯¼å…¥åŠŸèƒ½åŒ…

```bash
cd tools
./import-feature.sh /path/to/bundles
```

**åŠŸèƒ½ï¼š**
- ä»æŒ‡å®šç›®å½•å¯¼å…¥æ‰€æœ‰åŠŸèƒ½åŒ…
- è‡ªåŠ¨åŒ¹é…ä¸»ä»“åº“å’Œå­æ¨¡å—åŒ…
- æå–åŠŸèƒ½åˆ†æ”¯åç§°
- æä¾›åˆå¹¶æŒ‡å¯¼

### 6. åŒæ­¥æœåŠ¡å™¨æ›´æ–°

```bash
cd tools
./update-from-server.sh
```

**åŠŸèƒ½ï¼š**
- ä»æœåŠ¡å™¨åŒ…æ›´æ–°æœ¬åœ°ä»“åº“
- æ™ºèƒ½å¤„ç†åŠŸèƒ½åˆ†æ”¯å’Œä¸»åˆ†æ”¯
- è‡ªåŠ¨æ›´æ–°æ‰€æœ‰å­æ¨¡å—
- ä¿æŒå¼€å‘åˆ†æ”¯çŠ¶æ€

---

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åç¤ºä¾‹ | è¯´æ˜ |
|------|----------|------|
| å®Œæ•´åŒ… | `slam-core.bundle` | åŒ…å«æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾ |
| åŠŸèƒ½åŒ… | `slam-core-dev-feature.bundle` | å¢é‡åŒ…ï¼Œä»…åŒ…å«å˜æ›´ |
| å­æ¨¡å—åŒ… | `module_a.bundle` | å­æ¨¡å—çš„å®Œæ•´åŒ… |
| å­æ¨¡å—åŠŸèƒ½åŒ… | `module_a-dev-feature.bundle` | å­æ¨¡å—çš„å¢é‡åŒ… |

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```bash
# æœåŠ¡å™¨ç«¯
./export-full.sh /path/to/custom-server.config

# æœ¬åœ°ç«¯
./init-from-bundle.sh /path/to/custom-local.config
```

### è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—

å·¥å…·ä¼šè‡ªåŠ¨ä» `.gitmodules` æ–‡ä»¶æ£€æµ‹å­æ¨¡å—ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ï¼š

```bash
# è‡ªåŠ¨æ£€æµ‹ç»“æœç¤ºä¾‹
Detected submodules: module_a,module_b
```

### æ‰¹é‡å¤„ç†

```bash
# æ‰¹é‡åˆ›å»ºå¤šä¸ªåŠŸèƒ½åˆ†æ”¯
for feature in feature1 feature2 feature3; do
    ./create-feature-branch.sh $feature
done
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯ | æ£€æŸ¥ `repo_path` å’Œ `bundle_source` è·¯å¾„ |
| å­æ¨¡å—æœªåˆå§‹åŒ– | è¿è¡Œ `git submodule init` åé‡è¯• |
| åŒ…æ–‡ä»¶ä¸å­˜åœ¨ | ç¡®ä¿åŒ…æ–‡ä»¶åœ¨æŒ‡å®šç›®å½•ä¸­ |
| åˆ†æ”¯åç§°å†²çª | ä½¿ç”¨ `create-feature-branch.sh` åˆ›å»ºæ–°åˆ†æ”¯ |

### è°ƒè¯•æ¨¡å¼

æ‰€æœ‰è„šæœ¬éƒ½æ”¯æŒè¯¦ç»†è¾“å‡ºï¼Œé‡åˆ°é—®é¢˜æ—¶å¯ä»¥æŸ¥çœ‹ï¼š

```bash
# æŸ¥çœ‹è„šæœ¬æ‰§è¡Œè¿‡ç¨‹
bash -x ./export-full.sh
```

---

## ğŸ“„ è®¸å¯è¯

MIT License - å¯è‡ªç”±ä¿®æ”¹ä¸åˆ†å‘
